<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genres</title>
</head>
<body>
    <h1>Please choose a Genre</h1>
    <input type="text" id="searchInput" placeholder="Search genres">
    <button id="searchButton">Search</button>
    <p id="browseAllGenres" style="cursor: pointer; color: blue; text-decoration: underline;">Browse All Genres</p>
    <div id="genres"></div>

    <div id="relatedContent"></div>

    <script>
        var accessToken = "BQCYTAE2fLq79jwy5j__oTV8LNhbiZ33sJLI5ZUIwzt1okQyfKLcgXmfKqZqZFk1tCEU8q7V_Nt2h8ZCkFgBY_Xlx5hSYOSQHXid_FkHqNSQyAvJyuA";

        var isSearchPerformed = false;

        function renderGenres(genres) {
            var genresContainer = document.getElementById('genres');
            genresContainer.innerHTML = ''; 
            genres.forEach(function(genre) {
                var genreHTML = `
                    <div>
                        <a href="#" onclick="handleGenreClick('${genre.id}')">
                            <img src="${genre.icons[0].url}" alt="${genre.name}">
                            <p>${genre.name}</p>
                        </a>
                    </div>
                `;
                genresContainer.innerHTML += genreHTML;
            });
        }

        function fetchGenres(limit = 10) {
            fetch('https://api.spotify.com/v1/browse/categories?limit=' + limit, {
                headers: {
                    'Authorization': 'Bearer ' + accessToken
                }
            })
            .then(response => response.json())
            .then(data => {
                renderGenres(data.categories.items);
            })
            .catch(error => console.error('Error fetching genres:', error));
        }

        fetchGenres();

        function handleSearch() {
            var searchValue = document.getElementById('searchInput').value.toLowerCase();
            var relatedContentContainer = document.getElementById('relatedContent');
            relatedContentContainer.innerHTML = ''; // Clear existing related content
            fetch('https://api.spotify.com/v1/browse/categories?limit=20', {
                headers: {
                    'Authorization': 'Bearer ' + accessToken
                }
            })
            .then(response => response.json())
            .then(data => {
                var filteredGenres = data.categories.items.filter(function(genre) {
                    var genreName = genre.name.toLowerCase();
                    var normalizedSearchValue = searchValue.replace(/[^\w\s]/g, '');
                    var normalizedGenreName = genreName.replace(/[^\w\s]/g, '');
                    return normalizedGenreName.includes(normalizedSearchValue);
                });
                renderGenres(filteredGenres);
                isSearchPerformed = true; // Set the flag to true after search
            })
            .catch(error => console.error('Error fetching genres:', error));
        }

        function handleGenreClick(genreId) {
            var genresContainer = document.getElementById('genres');
            genresContainer.innerHTML = ''; // Clear existing genres
            fetchRelatedContent(genreId);
        }

        document.getElementById('searchButton').addEventListener('click', handleSearch);

        document.getElementById('searchInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                handleSearch();
            }
        });

        document.getElementById('browseAllGenres').addEventListener('click', function() {
            fetchGenres(50); // Fetch all genres by increasing the limit
        });

        function fetchRelatedContent(genreId) {
            fetch(`https://api.spotify.com/v1/browse/categories/${genreId}/playlists?limit=10`, {
                headers: {
                    'Authorization': 'Bearer ' + accessToken
                }
            })
            .then(response => response.json())
            .then(data => {
                displayRelatedContent(data.playlists.items);
            })
            .catch(error => console.error('Error fetching related content:', error));
        }

        function displayRelatedContent(content) {
            var relatedContentContainer = document.getElementById('relatedContent');
            relatedContentContainer.innerHTML = '<h2>Related Content</h2>';
            content.forEach(item => {
                var itemHTML = `
                    <div>
                        <a href="${item.href}" target="_blank">
                            <img src="${item.images[0].url}" alt="${item.name}">
                            <p>${item.name}</p>
                        </a>
                    </div>
                `;
                relatedContentContainer.innerHTML += itemHTML;
            });
        }

    </script>
</body>
</html>
